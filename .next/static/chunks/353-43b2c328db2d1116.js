"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[353],{9353:(e,t,s)=>{s.d(t,{A:()=>D});var a=s(5155),i=s(2115),n=s(285),r=s(5695),o=s(7481),l=s(3062),c=s(7262),d=s(6695),p=s(6424),u=s(9434);let y=e=>{let{dataTypes:t,onDataTypeToggle:s}=e;return(0,a.jsxs)("div",{className:"flex flex-col h-full p-6 bg-background",children:[" ",(0,a.jsxs)(d.aR,{className:"px-0 pt-0 pb-4 text-center",children:[" ",(0,a.jsx)(d.ZB,{className:"text-xl sm:text-2xl",children:"Select data type to include in the export"}),(0,a.jsx)(d.BT,{children:"Choose the type of data you want to export."})]}),(0,a.jsx)(p.F,{className:"flex-grow mb-6 pr-4 -mr-4",children:(0,a.jsxs)("div",{className:"max-w-md mx-auto w-full",children:[" ",(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[" ",t.map(e=>(0,a.jsx)(d.Zp,{className:(0,u.cn)("cursor-pointer transition-all hover:shadow-lg",e.selected?"border-primary ring-2 ring-primary":"border-border"),onClick:()=>s(e.id),children:(0,a.jsxs)(d.Wu,{className:"p-4 flex items-center space-x-3",children:[(0,a.jsx)(c.S,{id:"dt-".concat(e.id),checked:e.selected,onCheckedChange:()=>s(e.id),className:"h-5 w-5","aria-labelledby":"label-dt-".concat(e.id)}),(0,a.jsx)("label",{htmlFor:"dt-".concat(e.id),id:"label-dt-".concat(e.id),className:"font-medium text-sm text-foreground flex-grow cursor-pointer",children:e.name})]})},e.id))]})]})})]})};var h=s(8186),m=s(3203),f=s(7597),x=s(8086),g=s(5318),T=s(3911);function b(e){let{isOpen:t,onClose:s,onExportCreated:c,initialSelectedEntityTypes:d,initialIncludeRelationships:p,initialIncludeInteractions:u,initialFileFormat:b,initialDestination:D,initialWhenToExport:w,flowType:N}=e,k=(0,r.useSearchParams)(),j=(0,r.useRouter)(),{toast:v}=(0,o.dj)(),[C,S]=(0,i.useState)(()=>{let e=k.get("step");return e&&x.o.some(t=>t.id===e)?e:x.o[0].id}),[E,A]=(0,i.useState)(()=>{let e={selectedDataTypes:JSON.parse(JSON.stringify(l.WG)).map(e=>({...e,selected:!1})),entityTypes:JSON.parse(JSON.stringify(l.V)).map(e=>({...e,selected:["organization","supplier","product"].includes(e.id)})),relationshipTypes:JSON.parse(JSON.stringify(l.YS)).map(e=>({...e,selected:!1})),interactionTypes:JSON.parse(JSON.stringify(l.K9)).map(e=>({...e,selected:!1})),otherDataTypes:JSON.parse(JSON.stringify(l.el)).map(e=>({...e,selected:!1})),jobName:"Export organizations, suppliers, products data",dataWithChanges:"all",fileFormat:b||"CSV",destination:D||"Direct download",whenToExport:w||"Export now"};return k.get("step")&&(p&&(e.relationshipTypes=e.relationshipTypes.map(e=>({...e,selected:!0}))),u&&(e.interactionTypes=e.interactionTypes.map(e=>({...e,selected:!0})))),e});(0,i.useEffect)(()=>{if(C){let e=new URL(window.location.href);e.searchParams.set("step",C),window.history.replaceState({},"",e.toString())}},[C]);let O=(0,i.useCallback)(e=>{A(t=>({...t,...e}))},[]),J=(0,i.useCallback)(e=>{A(t=>{let s=t.selectedDataTypes.map(t=>t.id===e?{...t,selected:!t.selected}:t),a=t.selectedDataTypes.find(t=>{var a;return t.id===e&&!(null===(a=s.find(t=>t.id===e))||void 0===a?void 0:a.selected)}),i=t.entityTypes,n=t.relationshipTypes,r=t.interactionTypes,o=t.otherDataTypes;return a&&("entities"===a.id?i=i.map(e=>({...e,selected:!1,selectedAttributesCount:0})):"relationships"===a.id?n=n.map(e=>({...e,selected:!1,selectedAttributesCount:0})):"interactions"===a.id?r=r.map(e=>({...e,selected:!1,selectedAttributesCount:0})):"other"===a.id&&(o=o.map(e=>({...e,selected:!1,selectedAttributesCount:0})))),["mergeTree","matchData","activityLog","workflowTasks"].includes(e)&&(o=o.map(t=>{var a,i;return t.id===e?{...t,selected:null!==(i=null===(a=s.find(t=>t.id===e))||void 0===a?void 0:a.selected)&&void 0!==i&&i}:t})),{...t,selectedDataTypes:s,entityTypes:i,relationshipTypes:n,interactionTypes:r,otherDataTypes:o}})},[]),z=(0,i.useCallback)(e=>{A(t=>({...t,entityTypes:t.entityTypes.map(t=>t.id===e?{...t,selected:!t.selected}:t)}))},[]),R=(0,i.useCallback)(e=>{A(t=>({...t,relationshipTypes:t.relationshipTypes.map(t=>t.id===e?{...t,selected:!t.selected}:t)}))},[]),W=(0,i.useCallback)(e=>{A(t=>({...t,interactionTypes:t.interactionTypes.map(t=>t.id===e?{...t,selected:!t.selected}:t)}))},[]),$=(0,i.useCallback)(e=>{A(t=>({...t,otherDataTypes:t.otherDataTypes.map(t=>t.id===e?{...t,selected:!t.selected}:t)}))},[]),L=(0,i.useCallback)((e,t,s)=>{A(a=>{let i="".concat(t,"Types");if(Array.isArray(a[i])){let t=a[i].map(t=>{if(t.id===e){let e=s.filter(e=>e.selected).length;return{...t,attributes:s,selectedAttributesCount:e}}return t});return{...a,[i]:t}}return a})},[]),_=(0,i.useCallback)((e,t)=>{if("entity"===t){if("organization"===e)return l._k;if("product"===e)return l.sW;if("supplier"===e)return l.NR}return"relationship"===t?l.Xr:"interaction"===t?l.nZ:"other"===t?l.FR:[]},[]),B=(0,i.useMemo)(()=>"selectData"===C?!E.selectedDataTypes.some(e=>e.selected):"reviewDataset"===C&&!(E.entityTypes.some(e=>e.selected)||E.relationshipTypes.some(e=>e.selected)||E.interactionTypes.some(e=>e.selected)||E.otherDataTypes.some(e=>e.selected)),[C,E]),F="true"===k.get("openWizard")&&"configureData"===k.get("step");if(!t)return null;let I=C===x.o[x.o.length-1].id,U=x.o.find(e=>e.id===C),P=(null==U?void 0:U.label)?"".concat("quick"===N?"Quick Export":"Create New Export"," - ").concat(U.label):"quick"===N?"Quick Export":"Create New Export";return(0,a.jsxs)("div",{className:"flex flex-col h-full w-full bg-background shadow-2xl",children:[(0,a.jsxs)("div",{className:"p-4 border-b flex flex-row items-center justify-between shrink-0 relative h-[70px] bg-background sticky top-0 z-10",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)(n.$,{variant:"ghost",size:"icon",onClick:s,className:"rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 w-8 h-8",children:[(0,a.jsx)(g.A,{className:"h-5 w-5"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]}),(0,a.jsx)("span",{className:"text-lg font-semibold",children:P})]}),(0,a.jsx)("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:(0,a.jsx)(T.A,{currentStep:C,steps:[...x.o]})}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[C!==x.o[0].id&&(0,a.jsx)(n.$,{variant:"outline",onClick:()=>{if("configureData"===C){S("selectData");return}if("reviewDataset"===C){S("configureData");return}if("configuration"===C){S("reviewDataset");return}},className:"px-6 py-2 h-auto",children:"Back"}),(0,a.jsx)(n.$,{variant:"outline",onClick:()=>{console.log("Export configuration saved (mock):",E),alert("Export configuration saved (mock).")},className:"px-6 py-2 h-auto",children:"Save"}),I?(0,a.jsx)(n.$,{onClick:()=>{console.log("Initiating export with config:",E),c&&(c({id:"exp-".concat(Date.now()),name:E.jobName||"New Export Job ".concat(new Date().toLocaleString()),status:"Yet to start",statusColor:"gray",createdBy:"Current User (Mock)",exportDestination:E.destination||"Unknown Destination",schedule:"Export now"===E.whenToExport?"One time":E.whenToExport||"Unknown Schedule",actionIcons:["view","play","download","copy"],summary:{dataTypes:E.selectedDataTypes.filter(e=>e.selected).map(e=>e.name).join(", ")||"No data types selected"}}),v({title:"Export job started",description:"Your export job is now underway and will be ready in about 34 minutes. We'll notify you once it's done.",action:(0,a.jsx)(n.$,{variant:"outline",onClick:()=>j.push("/phase1?tab=data-export"),className:"mt-2",children:"View export jobs"}),duration:1e4})),s()},disabled:B,className:"px-6 py-2 h-auto",children:"Export"}):(0,a.jsx)(n.$,{onClick:()=>{if(x.o.findIndex(e=>e.id===C),"selectData"===C){if(!E.selectedDataTypes.some(e=>e.selected))return;S("configureData");return}if("configureData"===C){if(!(E.entityTypes.some(e=>e.selected)||E.relationshipTypes.some(e=>e.selected)||E.interactionTypes.some(e=>e.selected)||E.otherDataTypes.some(e=>e.selected))){alert("Please select at least one item to continue.");return}S("reviewDataset");return}if("reviewDataset"===C){S("configuration");return}},disabled:B,className:"px-6 py-2 h-auto",children:"Continue"})]})]}),(0,a.jsx)("div",{className:"flex-grow overflow-y-auto bg-background p-6",children:(()=>{if(F&&C===x.o[0].id)return S("configureData"),null;switch(C){case"selectData":return(0,a.jsx)(y,{dataTypes:E.selectedDataTypes,onDataTypeToggle:J});case"configureData":let e=E.selectedDataTypes.find(e=>"entities"===e.id&&e.selected)?E.entityTypes:[],t=E.selectedDataTypes.find(e=>"relationships"===e.id&&e.selected)?E.relationshipTypes:[],s=E.selectedDataTypes.find(e=>"interactions"===e.id&&e.selected)?E.interactionTypes:[],i=E.selectedDataTypes.some(e=>["mergeTree","matchData","activityLog","workflowTasks"].includes(e.id)&&e.selected)?E.otherDataTypes:[];return(0,a.jsx)(h.A,{selectedDataTypes:E.selectedDataTypes,entityTypesConfig:e,relationshipTypesConfig:t,interactionTypesConfig:s,otherDataTypesConfig:i,onEntityTypeToggle:z,onRelationshipTypeToggle:R,onInteractionTypeToggle:W,onOtherDataTypeToggle:$,onAttributesChange:L,getSampleData:_});case"reviewDataset":return(0,a.jsx)(m.A,{config:{selectedDataTypes:E.selectedDataTypes,entityTypes:E.entityTypes,relationshipTypes:E.relationshipTypes,interactionTypes:E.interactionTypes,otherDataTypes:E.otherDataTypes,datasetName:E.jobName||"New Export",description:"",target:E.destination||""},getSampleData:_});case"configuration":return(0,a.jsx)(f.A,{config:E,onConfigChange:O});default:return null}})()})]})}function D(e){return(0,a.jsx)(i.Suspense,{fallback:(0,a.jsx)("div",{children:"Loading..."}),children:(0,a.jsx)(b,{...e})})}}}]);